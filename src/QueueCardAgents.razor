@using Sufficit.Telephony.EventsPanel
@using Sufficit.Asterisk
@if (Items != null)
{
    @foreach (var item in Items)
    {
        <MudStack Row="true"
                  Spacing="1"
                  Class="@($"px-1 py-1 {GetAgentCardClass(item)}")" Style="width:100%">

            @* Status Icon *@
            <MudTooltip Text="@GetStatusTooltip(item)">
                <MudIconButton Icon="@GetAgentStatusIcon(item)"
                               Color="@GetAgentStatusColor(item)"
                               Size="Size.Small"
                               Class="agent-icon"
                               Style="cursor: pointer;" />
            </MudTooltip>

            @* Agent Name *@
            <MudStack Spacing="0" Justify="Justify.Center" Style="flex: 1; min-width: 0;">
                <MudTooltip Text="@item.Interface">
                    <MudText Class="agent-label text-truncate">
                        @FormatAgentDisplay(item)
                        @if (item.InCall)
                        {
                            <MudText Class="agent-label" Inline="true" Color="Color.Warning" Style="font-weight: bold;"> (Em chamada)</MudText>
                        }
                        else if (item.Paused)
                        {
                            <MudText Class="agent-label" Inline="true" Color="Color.Error"> (Pausado@(!string.IsNullOrWhiteSpace(item.PausedReason) ? $": {item.PausedReason}" : ""))</MudText>
                        }
                    </MudText>
                </MudTooltip>
            </MudStack>

            @* Call Duration (if InCall or InUse with LastCall) *@
            @if ((item.InCall || item.Status == AsteriskDeviceStatus.InUse) && item.LastCall > 0)
            {
                <MudText Class="agent-label"
                         Color="Color.Warning"
                         Style="font-weight: bold; white-space: nowrap;">
                    @GetCallDuration(item)
                </MudText>
            }
        </MudStack>
    }
}